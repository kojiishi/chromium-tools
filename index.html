<!DOCTYPE html>
<title>LayoutNG test failure charts</title>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<style>
html, body {
  margin: 0;
  padding: 0;
}
.chart {
  width: 100%;
  height: 50vh;
}
#dir {
  height: 100vh;
}
#ui {
  position: fixed;
  right: 0;
  top: 0;
  z-index: 1;
}
</style>
<script>
google.charts.load('current', {'packages':['corechart']});
const chart_loader = new Promise((resolve, reject) => {
  google.charts.setOnLoadCallback(resolve);
});
const by_failure = loadData('data/by_failure.json');
const by_dir = loadData('data/by_dir.json');

async function loadData(url) {
  let rs = await fetch(url);
  let data = await rs.json();
  await chart_loader;
  return google.visualization.arrayToDataTable(data);
}

function drawChart(id, data, title) {
  let element = document.getElementById(id);
  let renderer = new google.visualization.AreaChart(element);
  if (document.getElementById('hasMinDate').checked) {
    let filters = [{column: 0, minValue: document.getElementById('minDate').value}];
    data = new google.visualization.DataView(data);
    data.setRows(data.getFilteredRows(filters));
  }
  renderer.draw(data, {
    isStacked: true,
    title: title,
  });
}

async function drawCharts() {
  await chart_loader;
  drawChart('failure', await by_failure, 'Failure types');
  drawChart('dir', await by_dir, 'Directories');
}

window.addEventListener('load', drawCharts);
window.addEventListener('resize', drawCharts);
</script>
<body>
  <div id="ui">
    <input id="hasMinDate" type="checkbox" checked onchange="drawCharts()">
    <label for="hasMinDate">From:</label>
    <input id="minDate" type="date" value="2018-01-01" onchange="drawCharts()">
  </div>
  <div id="failure" class="chart"></div>
  <div id="dir" class="chart"></div>
</body>
